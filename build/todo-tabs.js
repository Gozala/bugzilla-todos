/** @jsx React.DOM */
var TodoTabs = (function() {
  var baseURL = "https://bugzilla.mozilla.org";
  var bugURL = baseURL + "/show_bug.cgi?id=";
  var attachURL = baseURL + "/attachment.cgi?id=";
  var reviewURL = baseURL + "/page.cgi?id=splinter.html&bug=" // +"&attachment=" + attachId;

  var TodoTabs = React.createClass({displayName: 'TodoTabs',
    render: function() {
      return (
        React.DOM.div({id: "todo-lists", className: "tabs"}, 
          TabsNav({tabs: this.props.tabs, 
              selectedTab: this.props.selectedTab, 
              data: this.props.data, 
              onTabClick: this.handleTabClick}), 
          TabsContent({tabs: this.props.tabs, 
              selectedTab: this.props.selectedTab, 
              data: this.props.data, 
              includeBlockedBugs: this.props.includeBlockedBugs})
        )
      );
    },
    handleTabClick: function(tabId) {
      this.props.onTabSelect(tabId);
    }
  });

  var TabsNav = React.createClass({displayName: 'TabsNav',
    render: function() {
      var selectedTab = this.props.selectedTab;

      var tabNodes = this.props.tabs.map(function(item, index) {
        var list = this.props.data[item.id];

        // display a count of the items and unseen items in this list
        var count = list.items ? list.items.length : "";
        var newCount = "";
        if (list.newCount) {
          newCount = (
            React.DOM.span({className: "new-count"}, 
              " +", list.newCount
            )
          );
        }

        var className = "tab" + (selectedTab == item.id ? " tab-selected" : "");

        return (
          React.DOM.a({href: "#", className: className, title: item.alt, 
             onClick: this.onClick.bind(this, item.id)}, 
            item.name, 
            React.DOM.span({className: "count"}, 
              count
            ), 
            newCount
          )
        );
      }.bind(this));

      return (
        React.DOM.div({className: "tab-head"}, 
          tabNodes
        )
      );
    },
    onClick: function(index) {
      this.props.onTabClick(index);
    }
  });

  var TabsContent = React.createClass({displayName: 'TabsContent',
    render: function() {
      var panelNodes = this.props.tabs.map(function(tab, index) {
        var data = this.props.data[tab.id];

        var list;
        switch(tab.type) {
          case "patches":
            list = PatchList({data: data});
            break;
          case "flags":
            list = RespondList({data: data});
            break;
          case "flags+reviews":
            list = NagList({data: data});
            break;
          case "bugs":
          default:
            list = BugList({data: data, 
                      includeBlockedBugs: this.props.includeBlockedBugs});
            break;
        }

        return (
          React.DOM.div({className: 'tab-content ' + (this.props.selectedTab == tab.id ?
                          'tab-content-selected' : '')}, 
            list
          )
        );
      }.bind(this));

      return (
        React.DOM.div({className: "tab-body"}, 
          panelNodes
        )
      );
    }
  });

  var BugList = React.createClass({displayName: 'BugList',
    render: function() {
      var items = this.props.data.items;
      if (items) {
        // filter out the blocked bugs, if pref is set
        if (!this.props.includeBlockedBugs) {
          items = items.filter(function(item) {
            return !item.bug.depends_on || !item.bug.depends_on.length;
          });
        }
        var listItems = items.map(function(item) {
          return (
            ListItem({isNew: item.new}, 
              BugItem({bug: item.bug})
            )
          );
        });
      }
      return (
        List({items: items}, 
          listItems
        )
      );
    }
  });

  var NagList = React.createClass({displayName: 'NagList',
    render: function() {
      var items = this.props.data.items;
      if (items) {
        var listItems = items.map(function(item) {
          var flags = item.flags.map(function(flag) {
            return FlagItem({flag: flag});
          });
          var patches = item.attachments.map(function(patch) {
            var patchFlags = patch.flags.map(function(flag) {
              return FlagItem({flag: flag});
            });
            return (
              React.DOM.div(null, 
                PatchItem({patch: patch}), 
                patchFlags
              )
            );
          });
          var requests = patches.concat(flags);

          return (
            ListItem({isNew: item.new}, 
              BugItem({bug: item.bug}), 
              React.DOM.div(null, 
                requests
              )
            )
          );
        });
      }
      return (
        List({items: items}, 
          listItems
        )
      );
    }
  });

  var RespondList = React.createClass({displayName: 'RespondList',
    render: function() {
      var items = this.props.data.items;
      if (items) {
        var listItems = items.map(function(item) {
          var flags = item.bug.flags.map(function(flag) {
            return FlagItem({flag: flag});
          });
          return (
            ListItem({isNew: item.new}, 
              BugItem({bug: item.bug}), 
              React.DOM.div(null, 
                flags
              )
            )
          );
        });
      }
      return (
        List({items: items}, 
          listItems
        )
      );
    }
  });

  var PatchList = React.createClass({displayName: 'PatchList',
    render: function() {
      var items = this.props.data.items;
      if (items) {
        var listItems = items.map(function(item) {
          var patches = item.attachments.map(function(patch) {
             return PatchItem({patch: patch});
          });
          return (
            ListItem({isNew: item.new}, 
              BugItem({bug: item.bug}), 
              React.DOM.div(null, 
                patches
              )
            )
          );
        });
      }
      return (
        List({items: items}, 
          listItems
        )
      );
    }
  });

  var List = React.createClass({displayName: 'List',
    render: function() {
      if (!this.props.items) {
        return WaitingList(null);
      }
      if (this.props.items.length == 0) {
        return EmptyList(null);
      }
      return (
        React.DOM.div(null, 
          this.props.children
        )
      );
    }
  })

  var WaitingList = React.createClass({displayName: 'WaitingList',
    render: function() {
      return (
        React.DOM.div({className: "list-item"}, 
          React.DOM.img({src: "lib/indicator.gif", className: "spinner"})
        )
      );
    }
  })

  var EmptyList = React.createClass({displayName: 'EmptyList',
    render: function() {
      return (
        React.DOM.div({className: "list-item empty-message"}, 
          "No items to display"
        )
      );
    }
  })

  var PatchItem = React.createClass({displayName: 'PatchItem',
    render: function() {
      var patch = this.props.patch;
      var size = Math.round(patch.size / 1000) + "KB";
      return (
        React.DOM.div(null, 
          React.DOM.a({className: "att-link", href: attachURL + patch.id, target: "_blank", 
             title: patch.description + " - " + size}, 
             "patch by ", patch.attacher.name
          ), 
          React.DOM.span({className: "att-suffix"}, 
            React.DOM.span({className: "att-date timeago", title: patch.last_change_time}, 
              patch.last_change_time
            )
          )
        )
      );
    }
  });

  var FlagItem = React.createClass({displayName: 'FlagItem',
    render: function() {
      var flag = this.props.flag;
      return (
        React.DOM.div({className: "flag"}, 
          React.DOM.span({className: "flag-name"}, 
            flag.name
          ), 
          React.DOM.span({className: "flag-status"}, 
            flag.status, "  "
          ), 
          React.DOM.span({className: "flag-requestee"}, 
            flag.requestee
          )
        )
      );
    }
  });

  var BugItem = React.createClass({displayName: 'BugItem',
    render: function() {
      var bug = this.props.bug;
      return (
        React.DOM.div({className: "bug"}, 
          React.DOM.a({className: "bug-link", href: bugURL + bug.id, 
             target: "_blank", title: bug.status + " - " + bug.summary}, 
            React.DOM.span({className: "bug-id"}, 
              bug.id
            ), 
            "- ", 
            React.DOM.span({className: "full-bug bug-summary"}, 
              bug.summary
            )
          ), 
          React.DOM.span({className: "item-date timeago", 
                title: bug.last_change_time}, 
            bug.last_change_time
          )
        )
      );
    }
  });

  var ListItem = React.createClass({displayName: 'ListItem',
    render: function() {
      return (
        React.DOM.div({className: "list-item " + (this.props.isNew ? "new-item" : "")}, 
          this.props.children
        )
      );
    }
  });

  return TodoTabs;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZWQuanMiLCJzb3VyY2VzIjpbbnVsbF0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHFCQUFxQjtBQUNyQixJQUFJLFFBQVEsR0FBRyxDQUFDLFdBQVc7RUFDekIsSUFBSSxPQUFPLEdBQUcsOEJBQThCLENBQUM7RUFDN0MsSUFBSSxNQUFNLEdBQUcsT0FBTyxHQUFHLG1CQUFtQixDQUFDO0VBQzNDLElBQUksU0FBUyxHQUFHLE9BQU8sR0FBRyxxQkFBcUIsQ0FBQztBQUNsRCxFQUFFLElBQUksU0FBUyxHQUFHLE9BQU8sR0FBRyxpQ0FBaUM7O0VBRTNELElBQUksOEJBQThCLHdCQUFBO0lBQ2hDLE1BQU0sRUFBRSxXQUFXO01BQ2pCO1FBQ0UsYUFBSSxDQUFBLENBQUEsQ0FBQyxFQUFBLEVBQUUsQ0FBQyxZQUFBLEVBQVksQ0FBQyxTQUFBLEVBQVMsQ0FBQyxNQUFPLENBQUEsRUFBQTtVQUNuQyxPQUFPLENBQUEsQ0FBQSxDQUFDLElBQUEsRUFBSSxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFDO2NBQzNCLFdBQUEsRUFBVyxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFDO2NBQ3BDLElBQUEsRUFBSSxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFDO2NBQ3RCLFVBQUEsRUFBVSxDQUFFLElBQUksQ0FBQyxjQUFlLENBQUUsQ0FBQSxFQUFBO1VBQ3JDLFdBQVcsQ0FBQSxDQUFBLENBQUMsSUFBQSxFQUFJLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUM7Y0FDL0IsV0FBQSxFQUFXLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUM7Y0FDcEMsSUFBQSxFQUFJLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUM7Y0FDdEIsa0JBQUEsRUFBa0IsQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGtCQUFtQixDQUFFLENBQUE7UUFDcEQsQ0FBQTtRQUNOO0tBQ0g7SUFD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aUI7VUFDakIsQ0FBQTtRQUNILENBQUE7UUFDTjtLQUNIO0FBQ0wsR0FBRyxDQUFDLENBQUM7O0VBRUgsSUFBSSw4QkFBOEIsd0JBQUE7SUFDaEMsTUFBTSxFQUFFLFdBQVc7TUFDakI7UUFDRSxhQUFJLENBQUEsQ0FBQSxDQUFDLFNBQUEsRUFBUyxDQUFFLFlBQVksSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxVQUFVLEdBQUcsRUFBRSxDQUFHLENBQUEsRUFBQTtVQUNsRSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVM7UUFDakIsQ0FBQTtRQUNOO0tBQ0g7QUFDTCxHQUFHLENBQUMsQ0FBQzs7RUFFSCxPQUFPLFFBQVEsQ0FBQztDQUNqQixHQUFHIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIEBqc3ggUmVhY3QuRE9NICovXG52YXIgVG9kb1RhYnMgPSAoZnVuY3Rpb24oKSB7XG4gIHZhciBiYXNlVVJMID0gXCJodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnXCI7XG4gIHZhciBidWdVUkwgPSBiYXNlVVJMICsgXCIvc2hvd19idWcuY2dpP2lkPVwiO1xuICB2YXIgYXR0YWNoVVJMID0gYmFzZVVSTCArIFwiL2F0dGFjaG1lbnQuY2dpP2lkPVwiO1xuICB2YXIgcmV2aWV3VVJMID0gYmFzZVVSTCArIFwiL3BhZ2UuY2dpP2lkPXNwbGludGVyLmh0bWwmYnVnPVwiIC8vICtcIiZhdHRhY2htZW50PVwiICsgYXR0YWNoSWQ7XG5cbiAgdmFyIFRvZG9UYWJzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IGlkPVwidG9kby1saXN0c1wiIGNsYXNzTmFtZT1cInRhYnNcIj5cbiAgICAgICAgICA8VGFic05hdiB0YWJzPXt0aGlzLnByb3BzLnRhYnN9XG4gICAgICAgICAgICAgIHNlbGVjdGVkVGFiPXt0aGlzLnByb3BzLnNlbGVjdGVkVGFifVxuICAgICAgICAgICAgICBkYXRhPXt0aGlzLnByb3BzLmRhdGF9XG4gICAgICAgICAgICAgIG9uVGFiQ2xpY2s9e3RoaXMuaGFuZGxlVGFiQ2xpY2t9Lz5cbiAgICAgICAgICA8VGFic0NvbnRlbnQgdGFicz17dGhpcy5wcm9wcy50YWJzfVxuICAgICAgICAgICAgICBzZWxlY3RlZFRhYj17dGhpcy5wcm9wcy5zZWxlY3RlZFRhYn1cbiAgICAgICAgICAgICAgZGF0YT17dGhpcy5wcm9wcy5kYXRhfVxuICAgICAgICAgICAgICBpbmNsdWRlQmxvY2tlZEJ1Z3M9e3RoaXMucHJvcHMuaW5jbHVkZUJsb2NrZWRCdWdzfS8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9LFxuICAgIGhhbmRsZVRhYkNsaWNrOiBmdW5jdGlvbih0YWJJZCkge1xuICAgICAgdGhpcy5wcm9wcy5vblRhYlNlbGVjdCh0YWJJZCk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgVGFic05hdiA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGVjdGVkVGFiID0gdGhpcy5wcm9wcy5zZWxlY3RlZFRhYjtcblxuICAgICAgdmFyIHRhYk5vZGVzID0gdGhpcy5wcm9wcy50YWJzLm1hcChmdW5jdGlvbihpdGVtLCBpbmRleCkge1xuICAgICAgICB2YXIgbGlzdCA9IHRoaXMucHJvcHMuZGF0YVtpdGVtLmlkXTtcblxuICAgICAgICAvLyBkaXNwbGF5IGEgY291bnQgb2YgdGhlIGl0ZW1zIGFuZCB1bnNlZW4gaXRlbXMgaW4gdGhpcyBsaXN0XG4gICAgICAgIHZhciBjb3VudCA9IGxpc3QuaXRlbXMgPyBsaXN0Lml0ZW1zLmxlbmd0aCA6IFwiXCI7XG4gICAgICAgIHZhciBuZXdDb3VudCA9IFwiXCI7XG4gICAgICAgIGlmIChsaXN0Lm5ld0NvdW50KSB7XG4gICAgICAgICAgbmV3Q291bnQgPSAoXG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJuZXctY291bnRcIj5cbiAgICAgICAgICAgICAgJm5ic3A7K3tsaXN0Lm5ld0NvdW50fVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJ0YWJcIiArIChzZWxlY3RlZFRhYiA9PSBpdGVtLmlkID8gXCIgdGFiLXNlbGVjdGVkXCIgOiBcIlwiKTtcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxhIGhyZWY9XCIjXCIgY2xhc3NOYW1lPXtjbGFzc05hbWV9IHRpdGxlPXtpdGVtLmFsdH1cbiAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLm9uQ2xpY2suYmluZCh0aGlzLCBpdGVtLmlkKX0+XG4gICAgICAgICAgICB7aXRlbS5uYW1lfVxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiY291bnRcIj5cbiAgICAgICAgICAgICAge2NvdW50fVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAge25ld0NvdW50fVxuICAgICAgICAgIDwvYT5cbiAgICAgICAgKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGFiLWhlYWRcIj5cbiAgICAgICAgICB7dGFiTm9kZXN9XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9LFxuICAgIG9uQ2xpY2s6IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICB0aGlzLnByb3BzLm9uVGFiQ2xpY2soaW5kZXgpO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIFRhYnNDb250ZW50ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcGFuZWxOb2RlcyA9IHRoaXMucHJvcHMudGFicy5tYXAoZnVuY3Rpb24odGFiLCBpbmRleCkge1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMucHJvcHMuZGF0YVt0YWIuaWRdO1xuXG4gICAgICAgIHZhciBsaXN0O1xuICAgICAgICBzd2l0Y2godGFiLnR5cGUpIHtcbiAgICAgICAgICBjYXNlIFwicGF0Y2hlc1wiOlxuICAgICAgICAgICAgbGlzdCA9IDxQYXRjaExpc3QgZGF0YT17ZGF0YX0vPjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJmbGFnc1wiOlxuICAgICAgICAgICAgbGlzdCA9IDxSZXNwb25kTGlzdCBkYXRhPXtkYXRhfS8+O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImZsYWdzK3Jldmlld3NcIjpcbiAgICAgICAgICAgIGxpc3QgPSA8TmFnTGlzdCBkYXRhPXtkYXRhfS8+O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImJ1Z3NcIjpcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgbGlzdCA9IDxCdWdMaXN0IGRhdGE9e2RhdGF9XG4gICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZUJsb2NrZWRCdWdzPXt0aGlzLnByb3BzLmluY2x1ZGVCbG9ja2VkQnVnc30vPjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17J3RhYi1jb250ZW50ICcgKyAodGhpcy5wcm9wcy5zZWxlY3RlZFRhYiA9PSB0YWIuaWQgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAndGFiLWNvbnRlbnQtc2VsZWN0ZWQnIDogJycpfT5cbiAgICAgICAgICAgIHtsaXN0fVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0YWItYm9keVwiPlxuICAgICAgICAgIHtwYW5lbE5vZGVzfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgQnVnTGlzdCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGl0ZW1zID0gdGhpcy5wcm9wcy5kYXRhLml0ZW1zO1xuICAgICAgaWYgKGl0ZW1zKSB7XG4gICAgICAgIC8vIGZpbHRlciBvdXQgdGhlIGJsb2NrZWQgYnVncywgaWYgcHJlZiBpcyBzZXRcbiAgICAgICAgaWYgKCF0aGlzLnByb3BzLmluY2x1ZGVCbG9ja2VkQnVncykge1xuICAgICAgICAgIGl0ZW1zID0gaXRlbXMuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybiAhaXRlbS5idWcuZGVwZW5kc19vbiB8fCAhaXRlbS5idWcuZGVwZW5kc19vbi5sZW5ndGg7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxpc3RJdGVtcyA9IGl0ZW1zLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxMaXN0SXRlbSBpc05ldz17aXRlbS5uZXd9PlxuICAgICAgICAgICAgICA8QnVnSXRlbSBidWc9e2l0ZW0uYnVnfS8+XG4gICAgICAgICAgICA8L0xpc3RJdGVtPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPExpc3QgaXRlbXM9e2l0ZW1zfT5cbiAgICAgICAgICB7bGlzdEl0ZW1zfVxuICAgICAgICA8L0xpc3Q+XG4gICAgICApO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIE5hZ0xpc3QgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBpdGVtcyA9IHRoaXMucHJvcHMuZGF0YS5pdGVtcztcbiAgICAgIGlmIChpdGVtcykge1xuICAgICAgICB2YXIgbGlzdEl0ZW1zID0gaXRlbXMubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICB2YXIgZmxhZ3MgPSBpdGVtLmZsYWdzLm1hcChmdW5jdGlvbihmbGFnKSB7XG4gICAgICAgICAgICByZXR1cm4gPEZsYWdJdGVtIGZsYWc9e2ZsYWd9Lz47XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIHBhdGNoZXMgPSBpdGVtLmF0dGFjaG1lbnRzLm1hcChmdW5jdGlvbihwYXRjaCkge1xuICAgICAgICAgICAgdmFyIHBhdGNoRmxhZ3MgPSBwYXRjaC5mbGFncy5tYXAoZnVuY3Rpb24oZmxhZykge1xuICAgICAgICAgICAgICByZXR1cm4gPEZsYWdJdGVtIGZsYWc9e2ZsYWd9Lz47XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgPFBhdGNoSXRlbSBwYXRjaD17cGF0Y2h9Lz5cbiAgICAgICAgICAgICAgICB7cGF0Y2hGbGFnc31cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHZhciByZXF1ZXN0cyA9IHBhdGNoZXMuY29uY2F0KGZsYWdzKTtcblxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8TGlzdEl0ZW0gaXNOZXc9e2l0ZW0ubmV3fT5cbiAgICAgICAgICAgICAgPEJ1Z0l0ZW0gYnVnPXtpdGVtLmJ1Z30vPlxuICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgIHtyZXF1ZXN0c31cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L0xpc3RJdGVtPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPExpc3QgaXRlbXM9e2l0ZW1zfT5cbiAgICAgICAgICB7bGlzdEl0ZW1zfVxuICAgICAgICA8L0xpc3Q+XG4gICAgICApO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIFJlc3BvbmRMaXN0ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaXRlbXMgPSB0aGlzLnByb3BzLmRhdGEuaXRlbXM7XG4gICAgICBpZiAoaXRlbXMpIHtcbiAgICAgICAgdmFyIGxpc3RJdGVtcyA9IGl0ZW1zLm1hcChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgdmFyIGZsYWdzID0gaXRlbS5idWcuZmxhZ3MubWFwKGZ1bmN0aW9uKGZsYWcpIHtcbiAgICAgICAgICAgIHJldHVybiA8RmxhZ0l0ZW0gZmxhZz17ZmxhZ30vPjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPExpc3RJdGVtIGlzTmV3PXtpdGVtLm5ld30+XG4gICAgICAgICAgICAgIDxCdWdJdGVtIGJ1Zz17aXRlbS5idWd9Lz5cbiAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICB7ZmxhZ3N9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9MaXN0SXRlbT5cbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxMaXN0IGl0ZW1zPXtpdGVtc30+XG4gICAgICAgICAge2xpc3RJdGVtc31cbiAgICAgICAgPC9MaXN0PlxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIHZhciBQYXRjaExpc3QgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBpdGVtcyA9IHRoaXMucHJvcHMuZGF0YS5pdGVtcztcbiAgICAgIGlmIChpdGVtcykge1xuICAgICAgICB2YXIgbGlzdEl0ZW1zID0gaXRlbXMubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICB2YXIgcGF0Y2hlcyA9IGl0ZW0uYXR0YWNobWVudHMubWFwKGZ1bmN0aW9uKHBhdGNoKSB7XG4gICAgICAgICAgICAgcmV0dXJuIDxQYXRjaEl0ZW0gcGF0Y2g9e3BhdGNofS8+O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8TGlzdEl0ZW0gaXNOZXc9e2l0ZW0ubmV3fT5cbiAgICAgICAgICAgICAgPEJ1Z0l0ZW0gYnVnPXtpdGVtLmJ1Z30vPlxuICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgIHtwYXRjaGVzfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvTGlzdEl0ZW0+XG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8TGlzdCBpdGVtcz17aXRlbXN9PlxuICAgICAgICAgIHtsaXN0SXRlbXN9XG4gICAgICAgIDwvTGlzdD5cbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgTGlzdCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLnByb3BzLml0ZW1zKSB7XG4gICAgICAgIHJldHVybiA8V2FpdGluZ0xpc3QvPjtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnByb3BzLml0ZW1zLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIHJldHVybiA8RW1wdHlMaXN0Lz47XG4gICAgICB9XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIHt0aGlzLnByb3BzLmNoaWxkcmVufVxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICB9KVxuXG4gIHZhciBXYWl0aW5nTGlzdCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsaXN0LWl0ZW1cIj5cbiAgICAgICAgICA8aW1nIHNyYz0nbGliL2luZGljYXRvci5naWYnIGNsYXNzTmFtZT0nc3Bpbm5lcic+PC9pbWc+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gIH0pXG5cbiAgdmFyIEVtcHR5TGlzdCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsaXN0LWl0ZW0gZW1wdHktbWVzc2FnZVwiPlxuICAgICAgICAgIE5vIGl0ZW1zIHRvIGRpc3BsYXlcbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgfSlcblxuICB2YXIgUGF0Y2hJdGVtID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcGF0Y2ggPSB0aGlzLnByb3BzLnBhdGNoO1xuICAgICAgdmFyIHNpemUgPSBNYXRoLnJvdW5kKHBhdGNoLnNpemUgLyAxMDAwKSArIFwiS0JcIjtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPGEgY2xhc3NOYW1lPVwiYXR0LWxpbmtcIiBocmVmPXthdHRhY2hVUkwgKyBwYXRjaC5pZH0gdGFyZ2V0PVwiX2JsYW5rXCJcbiAgICAgICAgICAgICB0aXRsZT17cGF0Y2guZGVzY3JpcHRpb24gKyBcIiAtIFwiICsgc2l6ZX0+XG4gICAgICAgICAgICAgcGF0Y2ggYnkge3BhdGNoLmF0dGFjaGVyLm5hbWV9XG4gICAgICAgICAgPC9hPlxuICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImF0dC1zdWZmaXhcIj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImF0dC1kYXRlIHRpbWVhZ29cIiB0aXRsZT17cGF0Y2gubGFzdF9jaGFuZ2VfdGltZX0+XG4gICAgICAgICAgICAgIHtwYXRjaC5sYXN0X2NoYW5nZV90aW1lfVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIEZsYWdJdGVtID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZmxhZyA9IHRoaXMucHJvcHMuZmxhZztcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxhZ1wiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImZsYWctbmFtZVwiPlxuICAgICAgICAgICAge2ZsYWcubmFtZX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZmxhZy1zdGF0dXNcIj5cbiAgICAgICAgICAgIHtmbGFnLnN0YXR1c30gJm5ic3A7XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImZsYWctcmVxdWVzdGVlXCI+XG4gICAgICAgICAgICB7ZmxhZy5yZXF1ZXN0ZWV9XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgQnVnSXRlbSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGJ1ZyA9IHRoaXMucHJvcHMuYnVnO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJidWdcIj5cbiAgICAgICAgICA8YSBjbGFzc05hbWU9XCJidWctbGlua1wiIGhyZWY9e2J1Z1VSTCArIGJ1Zy5pZH1cbiAgICAgICAgICAgICB0YXJnZXQ9XCJfYmxhbmtcIiB0aXRsZT17YnVnLnN0YXR1cyArIFwiIC0gXCIgKyBidWcuc3VtbWFyeX0+XG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJidWctaWRcIj5cbiAgICAgICAgICAgICAge2J1Zy5pZH1cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgIC0mbmJzcDtcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImZ1bGwtYnVnIGJ1Zy1zdW1tYXJ5XCI+XG4gICAgICAgICAgICAgIHtidWcuc3VtbWFyeX1cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8L2E+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiaXRlbS1kYXRlIHRpbWVhZ29cIlxuICAgICAgICAgICAgICAgIHRpdGxlPXtidWcubGFzdF9jaGFuZ2VfdGltZX0+XG4gICAgICAgICAgICB7YnVnLmxhc3RfY2hhbmdlX3RpbWV9XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgTGlzdEl0ZW0gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtcImxpc3QtaXRlbSBcIiArICh0aGlzLnByb3BzLmlzTmV3ID8gXCJuZXctaXRlbVwiIDogXCJcIil9PlxuICAgICAgICAgIHt0aGlzLnByb3BzLmNoaWxkcmVufVxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gVG9kb1RhYnM7XG59KSgpOyJdfQ==